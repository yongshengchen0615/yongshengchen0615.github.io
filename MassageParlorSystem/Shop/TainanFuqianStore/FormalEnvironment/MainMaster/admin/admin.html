<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>Admin 審核管理台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="admin.css" />

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <!-- 初始資料載入遮罩：首批資料準備好前顯示 -->
  <div id="initialLoading" class="initial-loading initial-loading-hidden">
    <div class="initial-loading-inner" role="status" aria-live="polite">
      <div class="spinner-lg" aria-hidden="true"></div>
      <p id="initialLoadingText" class="initial-loading-text"></p>
      <div class="initial-loading-progress" role="progressbar" aria-label="載入進度" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div id="initialLoadingBar" class="initial-loading-progress-bar" style="width:0%"></div>
      </div>
      <div id="initialLoadingPercent" class="initial-loading-percent">0%</div>
    </div>
  </div>

  <div class="app app-hidden">
    <div class="shell">

      <header class="topbar">
        <div class="brand">
          <div class="brand-mark">A</div>
          <div class="brand-text">
            <h1>Admin 審核管理台</h1>
            <p id="summaryText" hidden>載入中…</p>
            <p id="authText" class="auth-text">尚未登入</p>
          </div>
        </div>

        <div class="topbar-right">
          <button id="themeToggle" class="btn ghost" type="button">切換主題</button>
        </div>
      </header>

      <div class="viewbar" aria-label="切換名單">
        <button id="viewAdminsBtn" class="btn primary" type="button" aria-pressed="true">管理員名單</button>
        <button id="viewAdminLogsBtn" class="btn ghost" type="button" aria-pressed="false">管理員紀錄</button>
        <button id="viewUsersBtn" class="btn ghost" type="button" aria-pressed="false">技師名單</button>
        <button id="viewTechUsageLogsBtn" class="btn ghost" type="button" aria-pressed="false">技師使用紀錄</button>
        <button id="viewScheduleBtn" class="btn ghost" type="button" aria-pressed="false">排班表</button>
        <button id="viewPerformanceBtn" class="btn ghost" type="button" aria-pressed="false">業績查詢</button>
      </div>

      <section id="adminsKpiSection" class="kpi-grid" aria-label="統計資訊">
        <div class="kpi-card">
          <div class="kpi-label">總管理員</div>
          <div class="kpi-value" id="kpiTotal">-</div>
        </div>
        <div class="kpi-card success">
          <div class="kpi-label">通過</div>
          <div class="kpi-value" id="kpiApproved">-</div>
        </div>
        <div class="kpi-card warning">
          <div class="kpi-label">待審核</div>
          <div class="kpi-value" id="kpiPending">-</div>
        </div>
        <div class="kpi-card danger">
          <div class="kpi-label">拒絕</div>
          <div class="kpi-value" id="kpiRejected">-</div>
        </div>

        <div class="kpi-card muted">
          <div class="kpi-label">停用</div>
          <div class="kpi-value" id="kpiDisabled">-</div>
        </div>
        <div class="kpi-card maintenance">
          <div class="kpi-label">系統維護</div>
          <div class="kpi-value" id="kpiMaintenance">-</div>
        </div>
      </section>

      <!-- 排班表面板（移植自 Scheduling，結構與 class 與原專案一致） -->
      <section id="schedulePanelSection" aria-label="排班表" hidden>
        <div id="gate" class="gate gate-hidden"></div>

        <div id="initialLoading" class="initial-loading initial-loading-hidden">
          <div class="initial-loading-inner" role="status" aria-live="polite">
            <div class="spinner-lg" aria-hidden="true"></div>
            <p id="initialLoadingText" class="initial-loading-text"></p>
            <div class="initial-loading-progress" role="progressbar" aria-label="載入進度" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div id="initialLoadingBar" class="initial-loading-progress-bar" style="width:0%"></div>
            </div>
            <div id="initialLoadingPercent" class="initial-loading-percent">0%</div>
          </div>
        </div>

        <div id="topLoading" class="top-loading hidden" aria-live="polite" aria-atomic="true">
          <span class="top-loading-spinner" aria-hidden="true"></span>
          <span class="top-loading-text"></span>
        </div>

        <div class="layout">
          <header class="page-title">
            <!-- title intentionally removed -->
          </header>

          <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px;">
            <div class="pill pill-status">
              <span class="pill-dot"></span>
              <span class="pill-text" id="connectionStatus">尚未連線</span>
            </div>
            <div>
              <button id="refreshBtn" class="btn ghost" type="button">🔄 重新整理</button>
            </div>
          </div>

          <div id="myMasterStatus" class="my-master-status">
            <div class="my-master-head">
              <div class="my-master-title">師傅狀態</div>
              <div class="my-master-controls">
                <label for="statusMasterSelect" class="filter-label">師傅編號</label>
                <select id="statusMasterSelect" class="select">
                  <option value="">請選擇</option>
                </select>
              </div>
            </div>
            <div id="myMasterStatusText" class="my-master-text">請先選擇師傅編號</div>
          </div>

          <section class="toolbar">
            <div class="tabs">
              <button id="tabBody" class="tab tab-active" type="button">身體面板</button>
              <button id="tabFoot" class="tab" type="button">腳底面板</button>
            </div>

            <div class="filters">
              <div class="filter">
                <label for="filterMaster" class="filter-label">師傅搜尋</label>
                <select id="filterMaster" class="select">
                  <option value="">全部師傅</option>
                </select>
              </div>
              <div class="filter">
                <label for="filterStatus" class="filter-label">狀態篩選</label>
                <select id="filterStatus" class="select">
                  <option value="all">全部狀態</option>
                </select>
              </div>
            </div>
          </section>

          <main class="main">
            <section class="card card-table">
              <header class="card-header">
                <div class="card-header-left">
                  <h2 id="panelTitle" class="card-title">身體面板</h2>
                </div>
                <div class="card-header-right">
                  <span id="lastUpdate" class="badge">尚未更新</span>
                </div>
              </header>

              <div class="card-body">
                <div class="table-wrapper">
                  <table class="status-table">
                    <thead>
                      <tr>
                        <th style="width: 80px;">順序</th>
                        <th style="width: 80px;">師傅</th>
                        <th style="width: 160px;">狀態</th>
                        <th>預約內容</th>
                        <th style="width: 160px;">剩餘時間</th>
                      </tr>
                    </thead>
                    <tbody id="tbodyRows"></tbody>
                  </table>
                </div>

                <div id="emptyState" class="state state-empty">
                  <p>目前沒有任何資料。</p>
                </div>

                <div id="loadingState" class="state state-loading">
                  <div class="spinner"></div>
                  <p>資料載入中，請稍候…</p>
                </div>

                <div id="errorState" class="state state-error">
                  <p>無法取得資料，請稍後再試或使用右上角「手動重整」。</p>
                </div>
              </div>
            </section>
          </main>
        </div>
      </section>

      <section id="adminsPanelSection" class="panel">
        <div class="panel-head">
          <div class="panel-title" aria-hidden="true">
            <div class="panel-title-main">管理員名單</div>
          </div>

          <div class="filters">
            <div class="search-box" role="search">
              <span class="icon" aria-hidden="true">⌕</span>
              <input id="searchInput" class="input" placeholder="搜尋：userId / 名稱" autocomplete="off" />
              <button id="clearSearchBtn" class="btn icon ghost" type="button" aria-label="清除搜尋">✕</button>
            </div>

            <div class="seg" aria-label="審核狀態篩選">
              <button class="chip active" data-filter="ALL" type="button">全部</button>
              <button class="chip" data-filter="通過" type="button">通過</button>
              <button class="chip" data-filter="待審核" type="button">待審核</button>
              <button class="chip" data-filter="拒絕" type="button">拒絕</button>
              <button class="chip" data-filter="停用" type="button">停用</button>
              <button class="chip" data-filter="系統維護" type="button">系統維護</button>
            </div>
          </div>

          <div class="panel-meta">
            <div id="footerStatus" class="hint">-</div>
          </div>

          <div class="panel-actions" aria-label="管理員名單操作">
            <button id="reloadBtn" class="btn ghost" type="button">重新整理</button>
            <button id="saveAllBtn" class="btn primary" type="button" disabled>儲存全部變更</button>
          </div>
        </div>

        <div id="bulkBar" class="bulkbar" hidden>
          <div class="bulk-left">
            <span class="bulk-pill" id="bulkCount">已選取 0 筆</span>
            <button id="bulkClear" class="btn ghost" type="button">清除選取</button>
          </div>
          <div class="bulk-right">
            <div class="bulk-group">
              <label class="bulk-label" for="bulkAudit">批次審核</label>
              <select id="bulkAudit" class="select">
                <option value="">不變更</option>
                <option value="待審核">待審核</option>
                <option value="通過">通過</option>
                <option value="拒絕">拒絕</option>
                <option value="停用">停用</option>
                <option value="系統維護">系統維護</option>
                <option value="其他">其他</option>
              </select>
            </div>

            <button id="bulkApply" class="btn primary" type="button">套用到選取</button>
            <button id="bulkDelete" class="btn danger" type="button">批次刪除</button>
          </div>
        </div>

        <div class="table-wrap responsive-wrap" aria-label="Admins 列表">
          <table class="responsive-table" id="adminsTable">
            <thead>
              <tr>
                <th class="sticky-col col-check"><input id="checkAll" type="checkbox" aria-label="全選" /></th>
                <th>#</th>

                <!-- 舊欄位 -->
                <th>lineUserId</th>
                <th>lineDisplayName</th>
                <th>審核狀態</th>
                <th>建立時間</th>
                <th>最後登入</th>

                <!-- 新欄位（接在後面） -->
                <th title="推播功能開通">推播</th>
                <th title="技師審核狀態">技師審核</th>
                <th title="技師建立時間">建立</th>
                <th title="技師開始使用日期">開始日</th>
                <th title="技師使用期限">期限</th>
                <th title="技師師傅編號">師傅編號</th>
                <th title="技師是否師傅">是否師傅</th>
                <th title="技師是否推播">是否推播</th>
                <th title="技師個人狀態開通">個人狀態</th>
                <th title="技師排班表開通">排班表</th>
                <th title="技師業績開通">業績</th>
                <th title="技師預約查詢開通">預約查詢</th>

                <th class="sticky-right">操作</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <tr><td colspan="20">載入中...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- ✅ 管理員紀錄（僅顯示 ts / actorUserId / actorDisplayName） -->
      <section id="adminLogsPanelSection" class="panel" aria-label="管理員紀錄" hidden>
        <div class="panel-head">
          <div class="panel-title" aria-hidden="true">
            <div class="panel-title-main">管理員紀錄</div>
          </div>

          <div class="panel-meta range" aria-label="管理員紀錄日期範圍">
            <div class="panel-meta-group">
              <label class="bulk-label" for="logsStartDateInput">起日</label>
              <input id="logsStartDateInput" class="select" type="date" />
              <input id="logsStartTimeInput" class="select" type="time" />
            </div>
            <div class="panel-meta-group">
              <label class="bulk-label" for="logsEndDateInput">迄日</label>
              <input id="logsEndDateInput" class="select" type="date" />
              <input id="logsEndTimeInput" class="select" type="time" />
            </div>
          </div>

          <div class="panel-meta">
            <div id="logsFooterStatus" class="hint">-</div>
          </div>

          <div class="panel-actions" aria-label="管理員紀錄操作">
            <label for="logsMetricSelect" class="bulk-label">分析</label>
            <select id="logsMetricSelect" class="select">
              <option value="count">事件數</option>
              <option value="unique">不同管理員數</option>
            </select>
            <label for="logsGranularitySelect" class="bulk-label">粒度</label>
            <select id="logsGranularitySelect" class="select">
              <option value="auto">自動</option>
              <option value="hour">小時</option>
              <option value="day">日</option>
              <option value="week">週</option>
              <option value="month">月</option>
            </select>
            <label for="logsNameSelect" class="bulk-label">名稱</label>
            <select id="logsNameSelect" class="select">
              <option value="">全部</option>
            </select>
            <button id="logsShowAllBtn" class="btn ghost" type="button">全部</button>
            <button id="logsReloadBtn" class="btn ghost" type="button">重新整理</button>
          </div>
        </div>

        <div class="table-wrap responsive-wrap" aria-label="管理員紀錄列表">
          <div class="chart-wrap" style="padding:12px 14px; overflow:auto; -webkit-overflow-scrolling: touch;">
            <div id="adminLogsChartCanvas" aria-label="管理員紀錄圖表" role="img" style="width:100%;height:360px;min-width:320px;"></div>
          </div>
          <table class="responsive-table">
            <thead>
              <tr>
                <th>#</th>
                <th>ts</th>
                <th>actorUserId</th>
                <th>actorDisplayName</th>
              </tr>
            </thead>
            <tbody id="logsTbody">
              <tr><td colspan="4">等待管理員驗證後載入...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- KPI (Users/技師名單 - match client) -->
      <section id="usersKpiSection" class="kpi-grid" aria-label="技師統計資訊" hidden>
        <div class="kpi-card">
          <div class="kpi-label">總技師</div>
          <div class="kpi-value" id="uKpiTotal">-</div>
        </div>
        <div class="kpi-card success">
          <div class="kpi-label">通過</div>
          <div class="kpi-value" id="uKpiApproved">-</div>
        </div>
        <div class="kpi-card warning">
          <div class="kpi-label">待審核</div>
          <div class="kpi-value" id="uKpiPending">-</div>
        </div>
        <div class="kpi-card danger">
          <div class="kpi-label">拒絕</div>
          <div class="kpi-value" id="uKpiRejected">-</div>
        </div>
        <div class="kpi-card muted">
          <div class="kpi-label">停用</div>
          <div class="kpi-value" id="uKpiDisabled">-</div>
        </div>
        <div class="kpi-card maintenance">
          <div class="kpi-label">系統維護</div>
          <div class="kpi-value" id="uKpiMaintenance">-</div>
        </div>
      </section>

      <!-- ✅ Users/技師資料管理：直接在 admin 內製作（不嵌入、不外連） -->
      <section id="usersPanelSection" class="panel client-scope" aria-label="Users/技師資料管理" hidden>
        <div class="panel-head">
          <div class="panel-title" aria-hidden="true">
            <div class="panel-title-main">技師名單</div>
          </div>

          <div class="filters">
            <div class="search-box" role="search">
              <span class="icon" aria-hidden="true">⌕</span>
              <input
                id="uSearchInput"
                class="input"
                placeholder="搜尋：userId、名稱、師傅編號"
                autocomplete="off"
              />
              <button id="uClearSearchBtn" class="btn icon ghost" type="button" aria-label="清除搜尋">✕</button>
            </div>

            <div class="seg" aria-label="使用者審核狀態篩選">
              <button class="u-chip active" data-filter="ALL" type="button">全部</button>
              <button class="u-chip" data-filter="通過" type="button">通過</button>
              <button class="u-chip" data-filter="待審核" type="button">待審核</button>
              <button class="u-chip" data-filter="拒絕" type="button">拒絕</button>
              <button class="u-chip" data-filter="停用" type="button">停用</button>
              <button class="u-chip" data-filter="系統維護" type="button">系統維護</button>
            </div>
          </div>

          <div class="panel-actions">
            <button id="uReloadBtn" class="btn ghost" type="button">重新整理 Users</button>
            <button id="uSaveAllBtn" class="btn primary" type="button" disabled>儲存 Users 變更</button>
          </div>
        </div>

        <!-- Bulk bar -->
        <div id="uBulkBar" class="bulkbar" hidden>
          <div class="bulk-left">
            <span class="bulk-pill" id="uBulkCount">已選取 0 筆</span>
            <button id="uBulkClear" class="btn ghost" type="button">清除選取</button>
          </div>

          <div class="bulk-right">
            <div class="bulk-group">
              <label class="bulk-label" for="uBulkAudit">批次審核</label>
              <select id="uBulkAudit" class="select">
                <option value="">不變更</option>
                <option value="待審核">待審核</option>
                <option value="通過">通過</option>
                <option value="拒絕">拒絕</option>
                <option value="停用">停用</option>
                <option value="系統維護">系統維護</option>
                <option value="其他">其他</option>
              </select>
            </div>

            <div class="bulk-group">
              <label class="bulk-label" for="uBulkPush">批次推播</label>
              <select id="uBulkPush" class="select">
                <option value="">不變更</option>
                <option value="是">開啟</option>
                <option value="否">關閉</option>
              </select>
            </div>

            <div class="bulk-group">
              <label class="bulk-label" for="uBulkPersonalStatus">批次個人狀態</label>
              <select id="uBulkPersonalStatus" class="select">
                <option value="">不變更</option>
                <option value="是">開啟</option>
                <option value="否">關閉</option>
              </select>
            </div>

            <div class="bulk-group">
              <label class="bulk-label" for="uBulkScheduleEnabled">批次排班表</label>
              <select id="uBulkScheduleEnabled" class="select">
                <option value="">不變更</option>
                <option value="是">開啟</option>
                <option value="否">關閉</option>
              </select>
            </div>

            <div class="bulk-group">
              <label class="bulk-label" for="uBulkPerformanceEnabled">批次業績</label>
              <select id="uBulkPerformanceEnabled" class="select">
                <option value="">不變更</option>
                <option value="是">開啟</option>
                <option value="否">關閉</option>
              </select>
            </div>

            <div class="bulk-group">
              <label class="bulk-label" for="uBulkBookingEnabled">批次預約查詢</label>
              <select id="uBulkBookingEnabled" class="select">
                <option value="">不變更</option>
                <option value="是">開啟</option>
                <option value="否">關閉</option>
              </select>
            </div>

            <div class="bulk-group">
              <label class="bulk-label" for="uBulkUsageDays">批次期限(天)</label>
              <input id="uBulkUsageDays" class="select" type="number" min="1" placeholder="不變更" />
            </div>

            <div class="bulk-group">
              <label class="bulk-label" for="uBulkStartDate">批次開始使用</label>
              <input id="uBulkStartDate" class="select" type="date" />
            </div>

            <button id="uBulkApply" class="btn primary" type="button">套用到選取</button>
            <button id="uBulkDelete" class="btn danger" type="button">批次刪除</button>
          </div>
        </div>

        <!-- Table -->
        <div class="table-wrap" aria-label="使用者列表（可編輯）">
          <table id="uUsersTable">
            <thead>
              <tr>
                <th class="sticky-col col-check"><input id="uCheckAll" type="checkbox" aria-label="全選" /></th>
                <th>#</th>
                <th>userId</th>
                <th>顯示名稱</th>
                <th>建立時間</th>
                <th>開始使用</th>
                <th>期限(天)</th>
                <th>使用狀態</th>
                <th>審核狀態</th>
                <th>師傅編號</th>
                <th>是否師傅</th>
                <th>是否推播</th>
                <th>個人狀態開通</th>
                <th>排班表開通</th>
                <th>業績開通</th>
                <th>預約查詢開通</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="uTbody">
              <tr><td colspan="17">等待管理員驗證後載入...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- ✅ 技師使用紀錄（僅顯示 serverTime / userId / name / detail） -->
      <!-- (已移至技師使用紀錄面板內) -->

      <section id="techUsageLogsPanelSection" class="panel" aria-label="技師使用紀錄" hidden>
        <div class="panel-head">
          <div class="panel-title" aria-hidden="true">
            <div class="panel-title-main">技師使用紀錄</div>
          </div>

          <div class="panel-meta range" aria-label="技師使用紀錄日期範圍">
            <div class="panel-meta-group">
              <label class="bulk-label" for="techLogsStartDateInput">起日</label>
              <input id="techLogsStartDateInput" class="select" type="date" />
              <input id="techLogsStartTimeInput" class="select" type="time" />
            </div>
            <div class="panel-meta-group">
              <label class="bulk-label" for="techLogsEndDateInput">迄日</label>
              <input id="techLogsEndDateInput" class="select" type="date" />
              <input id="techLogsEndTimeInput" class="select" type="time" />
            </div>
          </div>

          <div class="panel-meta">
            <div id="techLogsFooterStatus" class="hint">-</div>
          </div>

          <div class="panel-actions" aria-label="技師使用紀錄操作">
            <label for="techLogsMetricSelect" class="bulk-label">分析</label>
            <select id="techLogsMetricSelect" class="select">
              <option value="count">事件數</option>
              <option value="unique">不同使用者數</option>
            </select>
            <label for="techLogsGranularitySelect" class="bulk-label">粒度</label>
            <select id="techLogsGranularitySelect" class="select">
              <option value="auto">自動</option>
              <option value="hour">小時</option>
              <option value="day">日</option>
              <option value="week">週</option>
              <option value="month">月</option>
            </select>
            <label for="techLogsEventSelect" class="bulk-label">事件類型</label>
            <select id="techLogsEventSelect" class="select">
              <option value="">全部</option>
            </select>
            <label for="techLogsNameSelect" class="bulk-label">名稱</label>
            <select id="techLogsNameSelect" class="select">
              <option value="">全部</option>
            </select>
            <button id="techLogsDeleteByNameBtn" class="btn danger" type="button" disabled>刪除該技師紀錄</button>
            <button id="techLogsShowAllBtn" class="btn ghost" type="button">全部</button>
            <button id="techLogsReloadBtn" class="btn ghost" type="button">重新整理</button>
          </div>
        </div>

        <div class="table-wrap" style="padding:12px 14px;">
          <div class="chart-wrap" style="overflow:auto; -webkit-overflow-scrolling: touch;">
            <div id="techUsageChartCanvas" aria-label="技師使用紀錄圖表" role="img" style="width:100%;height:360px;min-width:320px;"></div>
          </div>
        </div>

        <div class="table-wrap responsive-wrap" aria-label="技師使用紀錄列表">
          <table class="responsive-table">
            <thead>
              <tr>
                <th>#</th>
                <th>serverTime</th>
                <th>eventCn</th>
                <th>userId</th>
                <th>name</th>
                <th>detail</th>
              </tr>
            </thead>
            <tbody id="techLogsTbody">
              <tr><td colspan="6">等待管理員驗證後載入...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- ✅ 業績查詢（移植 Scheduling） -->
      <section id="performancePanelSection" class="panel" aria-label="業績查詢" hidden>
        <div class="panel-head">
          <div class="panel-title" aria-hidden="true">
            <div class="panel-title-main">業績查詢</div>
          </div>
        </div>

        <div class="panel-body">
          <div class="filters perf-filters">
            <div class="filter perf-tech-cell">
              <label for="perfTechNoSelect" class="filter-label">師傅編號</label>
              <select id="perfTechNoSelect" class="select">
                <option value="">請選擇</option>
              </select>
            </div>
            <div class="filter perf-start-cell">
              <label for="perfDateStart" class="filter-label">開始日期</label>
              <input id="perfDateStart" class="input" type="date" lang="en-CA" />
            </div>
            <div class="filter perf-end-cell">
              <label for="perfDateEnd" class="filter-label">結束日期</label>
              <input id="perfDateEnd" class="input" type="date" lang="en-CA" />
            </div>
            <div class="filter perf-quick-cell">
              <label class="filter-label">快速區間</label>
              <div class="perf-quick-range" role="group" aria-label="快速套用日期區間">
                <button class="perf-range-chip" type="button" data-range="d7">近7天</button>
                <button class="perf-range-chip" type="button" data-range="d30">近30天</button>
                <button class="perf-range-chip" type="button" data-range="thisMonth">本月</button>
                <button class="perf-range-chip" type="button" data-range="lastMonth">上月</button>
              </div>
            </div>
              <div class="filter perf-actions-cell">
              <label class="filter-label" aria-hidden="true">&nbsp;</label>
              <div class="perf-actions">
                <button id="perfSearchSummary" class="btn ghost" type="button">業績統計</button>
                <button id="perfSearchDetail" class="btn ghost" type="button">業績明細</button>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <header class="card-header">
              <div class="card-header-left">
                <h2 class="card-title">師傅業績</h2>
                <div style="display:flex;flex-direction:column;gap:4px;">
                  <p id="perfMeta" class="card-subtitle">—</p>
                  <p id="perfMonthRates" class="card-subtitle" style="font-weight:600;">—</p>
                </div>
              </div>
              <div class="card-header-right">
                <span id="perfStatus" class="badge">尚未查詢</span>
              </div>
            </header>

            <div class="card-body">
              <div class="table-wrapper" style="margin-bottom:12px;">
                <table class="status-table perf-summary-table">
                  <thead>
                    <tr>
                      <th style="width:120px;">類別</th>
                      <th>單數</th>
                      <th>筆數</th>
                      <th>數量</th>
                      <th>金額</th>
                    </tr>
                  </thead>
                  <tbody id="perfSummaryRows">
                    <tr><td colspan="5" style="color:var(--text-sub);">請先查詢。</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="chart-toolbar" aria-label="圖表工具列">
                <div class="chart-modes" role="group" aria-label="圖表模式">
                  <button id="perfChartModeDaily" class="btn ghost btn-chart-mode" type="button" data-mode="daily">日業績</button>
                  <button id="perfChartModeCumu"  class="btn ghost btn-chart-mode" type="button" data-mode="cumu">累積</button>
                  <button id="perfChartModeMA7"   class="btn ghost btn-chart-mode" type="button" data-mode="ma7">7日均線</button>
                  <button id="perfChartModeBar"  class="btn ghost btn-chart-mode" type="button" data-mode="bar">柱狀圖</button>
                </div>
                <button id="perfChartReset" class="btn ghost btn-chart-reset" type="button">↩︎ 重設顯示</button>
              </div>

              <div class="chart-toggle" role="group" aria-label="圖表顯示項目">
                <label class="toggle-chip">
                  <input id="perfChartToggleAmount" type="checkbox" checked />
                  <span>金額</span>
                </label>

                <label class="toggle-chip">
                  <input id="perfChartToggleOldRate" type="checkbox" checked />
                  <span>老點率</span>
                </label>

                <label class="toggle-chip">
                  <input id="perfChartToggleSchedRate" type="checkbox" checked />
                  <span>排班率</span>
                </label>
              </div>

              <div id="perfChartHint" class="perf-chart-hint" aria-live="polite">提示：可左右拖曳圖表，點選日期可看當日明細。</div>

              <div class="chart-wrapper" style="margin:10px 0 12px 0;">
                <canvas id="perfChart" height="160" aria-label="業績趨勢圖表" role="img"></canvas>
                <div id="perfChartOverlay" class="perf-chart-overlay" aria-live="polite" aria-atomic="true" hidden></div>
              </div>

              <div class="table-wrapper">
                <table class="status-table perf-detail-table">
                  <thead>
                    <tr id="perfDetailHeadRow">
                      <th>服務項目</th>
                      <th>總筆數</th>
                      <th>總節數</th>
                      <th>總計金額</th>
                      <th>老點筆數</th>
                      <th>老點節數</th>
                      <th>老點金額</th>
                      <th>排班筆數</th>
                      <th>排班節數</th>
                      <th>排班金額</th>
                    </tr>
                  </thead>
                  <tbody id="perfDetailRows"></tbody>
                </table>
              </div>

              <div id="perfEmpty" class="state state-empty" style="display:none;">
                <p>查無明細資料。</p>
              </div>

              <div id="perfError" class="state state-error" style="display:none;">
                <p>無法取得業績資料，請稍後再試。</p>
              </div>

              <div style="margin-top:10px;">
                <span id="perfDetailCount" class="badge">0 筆</span>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- ✅ 無權限擋頁 Overlay -->
  <div id="blocker" class="blocker" hidden>
    <div class="blocker-card" role="dialog" aria-modal="true" aria-labelledby="blockerTitle">
      <div class="blocker-badge">ACCESS</div>
      <h2 id="blockerTitle" class="blocker-title">無權限使用</h2>
      <p id="blockerMsg" class="blocker-msg">
        你的 LINE 帳號不在管理者清單中，請聯絡系統管理員。
      </p>

      <div class="blocker-meta" id="blockerMeta">-</div>

      <div class="blocker-actions">
        <button id="btnCopyUserId" class="btn primary" type="button">複製 userId</button>
        <button id="btnCloseLiff" class="btn danger" type="button">關閉</button>
      </div>
    </div>
  </div>

  <!-- 拆分後的 JS（使用 defer 並依序載入，確保相依性正確） -->
  <script src="js/admin.constants.js" defer></script>
  <script src="js/admin.state.js" defer></script>
  <script src="js/admin.utils.js" defer></script>
  <script src="js/admin.data.js" defer></script>
  <script src="js/admin.api.js" defer></script>
  <script src="js/admin.ui.js" defer></script>
  <script src="js/admin.features.js" defer></script>

  <!-- Chart.js CDN (performance) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

  <!-- ECharts (used by admin logs & tech usage) -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js" defer></script>

  <!-- 管理員紀錄（GAS UsageLog） -->
  <script src="js/admin.logs.js" defer></script>

  <!-- 技師使用紀錄（GAS usage_log） -->
  <script src="js/admin.techUsageLogs.js" defer></script>

  <!-- 業績查詢（移植 Scheduling） -->
  <script src="js/admin.performance.js" defer></script>

  <!-- Users/技師資料管理（獨立區塊，不影響原本 admin 清單） -->
  <script src="js/admin.users.js" defer></script>

  <!-- 入口檔（DOMContentLoaded 初始化） -->
  <script src="js/admin.js" defer></script>
  
  <!-- 移植的排班表模組（以 ES module 載入，已移除登入認證） -->
  <script type="module" src="js/schedule/app.js" defer></script>
</body>
</html>
