<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>Admin 審核管理台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="admin.css" />

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <div class="app">
    <div class="shell">

      <header class="topbar">
        <div class="brand">
          <div class="brand-mark">A</div>
          <div class="brand-text">
            <h1>Admin 審核管理台</h1>
            <p id="summaryText">載入中…</p>
            <p id="authText" class="auth-text">尚未登入</p>
          </div>
        </div>

        <div class="topbar-right">
          <button id="themeToggle" class="btn ghost" type="button">切換主題</button>
          <button id="reloadBtn" class="btn ghost" type="button">重新整理</button>
          <button id="saveAllBtn" class="btn primary" type="button" disabled>儲存全部變更</button>
        </div>
      </header>

      <section class="kpi-grid" aria-label="統計資訊">
        <div class="kpi-card">
          <div class="kpi-label">總管理員</div>
          <div class="kpi-value" id="kpiTotal">-</div>
        </div>
        <div class="kpi-card success">
          <div class="kpi-label">通過</div>
          <div class="kpi-value" id="kpiApproved">-</div>
        </div>
        <div class="kpi-card warning">
          <div class="kpi-label">待審核</div>
          <div class="kpi-value" id="kpiPending">-</div>
        </div>
        <div class="kpi-card danger">
          <div class="kpi-label">拒絕</div>
          <div class="kpi-value" id="kpiRejected">-</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div class="filters">
            <div class="search-box" role="search">
              <span class="icon" aria-hidden="true">⌕</span>
              <input id="searchInput" class="input" placeholder="搜尋：userId / 名稱" autocomplete="off" />
              <button id="clearSearchBtn" class="btn icon ghost" type="button" aria-label="清除搜尋">✕</button>
            </div>

            <div class="seg" aria-label="審核狀態篩選">
              <button class="chip active" data-filter="ALL" type="button">全部</button>
              <button class="chip" data-filter="通過" type="button">通過</button>
              <button class="chip" data-filter="待審核" type="button">待審核</button>
              <button class="chip" data-filter="拒絕" type="button">拒絕</button>
              <button class="chip" data-filter="停用" type="button">停用</button>
              <button class="chip" data-filter="系統維護" type="button">系統維護</button>
            </div>
          </div>

          <div class="panel-meta">
            <div id="footerStatus" class="hint">-</div>
          </div>
        </div>

        <div id="bulkBar" class="bulkbar" hidden>
          <div class="bulk-left">
            <span class="bulk-pill" id="bulkCount">已選取 0 筆</span>
            <button id="bulkClear" class="btn ghost" type="button">清除選取</button>
          </div>
          <div class="bulk-right">
            <div class="bulk-group">
              <label class="bulk-label" for="bulkAudit">批次審核</label>
              <select id="bulkAudit" class="select">
                <option value="">不變更</option>
                <option value="待審核">待審核</option>
                <option value="通過">通過</option>
                <option value="拒絕">拒絕</option>
                <option value="停用">停用</option>
                <option value="系統維護">系統維護</option>
                <option value="其他">其他</option>
              </select>
            </div>

            <button id="bulkApply" class="btn primary" type="button">套用到選取</button>
            <button id="bulkDelete" class="btn danger" type="button">批次刪除</button>
          </div>
        </div>

        <div class="table-wrap" aria-label="Admins 列表">
          <table>
            <thead>
              <tr>
                <th class="sticky-col col-check"><input id="checkAll" type="checkbox" aria-label="全選" /></th>
                <th>#</th>

                <!-- 舊欄位 -->
                <th>lineUserId</th>
                <th>lineDisplayName</th>
                <th>審核狀態</th>
                <th>建立時間</th>
                <th>最後登入</th>

                <!-- 新欄位（接在後面） -->
                <th>技師審核狀態</th>
                <th>技師建立時間</th>
                <th>技師開始使用日期</th>
                <th>技師使用期限</th>
                <th>技師師傅編號</th>
                <th>技師是否師傅</th>
                <th>技師是否推播</th>
                <th>技師個人狀態開通</th>
                <th>技師排班表開通</th>

                <th>操作</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <tr><td colspan="17">載入中...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- ✅ 無權限擋頁 Overlay -->
  <div id="blocker" class="blocker" hidden>
    <div class="blocker-card" role="dialog" aria-modal="true" aria-labelledby="blockerTitle">
      <div class="blocker-badge">ACCESS</div>
      <h2 id="blockerTitle" class="blocker-title">無權限使用</h2>
      <p id="blockerMsg" class="blocker-msg">
        你的 LINE 帳號不在管理者清單中，請聯絡系統管理員。
      </p>

      <div class="blocker-meta" id="blockerMeta">-</div>

      <div class="blocker-actions">
        <button id="btnCopyUserId" class="btn primary" type="button">複製 userId</button>
        <button id="btnCloseLiff" class="btn danger" type="button">關閉</button>
      </div>
    </div>
  </div>

  <script src="admin.js" defer></script>
</body>
</html>
